# Test conditions for N17995 CTC C2 using TMC13 trisoup
# trisoup lossy-geom  --  lossy-attrs liftt
#  -- cat 1 only, since trisoup doesn't apply to very sparce clouds
---
categories:
  lossy-geom-lossy-attrs:
    encflags:
     - mode: 0

     ##
     # geometry parameters (trisoup)
     - randomAccessPeriod: 32
     - interPredictionEnabled: 1
     -
       - !conditional '"${group}" =~ m{^cat2}'
       - localMotionEnabled: 1
       - motionParamPreset: 3
       - entropyContinuationEnabled: 1
       - GoFGeometryEntropyContinuationEnabled: 1
       # disable qtbt, it may crash local motion currently
       - qtbtEnabled: 0
     - neighbourAvailBoundaryLog2: 8
     - intra_pred_max_node_size_log2: 6
     - inferredDirectCodingMode: 0
     - planarEnabled: 1
     -
       - !conditional '"${group}" =~ m{^cat2}'
       - planarEnabled: 0
     - planarModeIdcmUse: 0
     - positionQuantizationScale: '$eval{ 1 / (1 << ( ${src-geometry-precision} - ${test-depth} )) }'
     - trisoupNodeSizeLog2:
         r01: 5
         r02: 4
         r03: 3
         r04: 2
     - trisoupQuantizationBits: 2
     - trisoupCentroidResidualEnabled:
         r01: 1
         r02: 1
         r03: 1
         r04: 0
     - trisoupHaloEnabled: 1
     - trisoupFineRayTracingEnabled: 1
     - trisoupImprovedEncoderEnabled: 1
     -
       - !conditional '"${group}" =~ m{^cat2}'
       - safeTrisoupPartionning: 0 # safeTrisoupPartitionning not working properly with cat2

     ####
     # attribute coding (common options -- relies on option ordering)
     #  - use lifting transform for lossy conditions
     - convertPlyColourspace: 1
     - transformType: 2
     - numberOfNearestNeighborsInPrediction: 3
     - levelOfDetailCount: '$eval{ ${seq_lod} || 12 }'
     - lodDecimator: 0
     -
       - !conditional '"${group}" =~ m{^cat3}'
       - lodDecimator: 1
       - lod_neigh_bias: ${seq_lod_bias}

     ##
     # attribute coding -- colour
     -
       - !conditional '${has_colour}'
       - adaptivePredictionThreshold: 64
       - qp:
           r01: 40
           r02: 34
           r03: 28
           r04: 22
       - qpChromaOffset: 0
       - bitdepth: 8
       - attribute: color

    decflags:
     - mode: 1
     - convertPlyColourspace: 1

    pcerrorflags:
     - dropdups: 2
     - neighborsProc: 1

    sequences:
      # cat2
      8ivfbv2_longdress_vox10:   { test-depth: 10 }
      8ivfbv2_loot_vox10:        { test-depth: 10 }
      8ivfbv2_redandblack_vox10: { test-depth: 10 }
      8ivfbv2_soldier_vox10:     { test-depth: 10 }
      basketball_player_vox11:   { test-depth: 11 }
      dancer_player_vox11:       { test-depth: 11 }
      queen:                     { test-depth: 10 }

